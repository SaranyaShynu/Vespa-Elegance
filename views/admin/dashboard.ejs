<%- include('../partials/admin/header') %>

<div class="admin-container">
  
  <!-- Sidebar -->
  <%- include('../partials/admin/sidebar') %> 

  <!-- Main Content -->
  <main class="admin-main dashboard-main">
    <h2>Welcome, <%= adminName %></h2>

    <!-- Stats Section -->
    <div class="stats">
      <div class="stat-card">ðŸ“¦ Products: <%= productCount %></div>
      <div class="stat-card">ðŸ›’ Orders: <%= orderCount %></div>
      <div class="stat-card">ðŸ‘¤ Users: <%= userCount %></div>
    </div>

    <!-- Filter -->
    <div class="chart-filter">
      <label for="filterSelect"><strong>Filter by:</strong></label>
      <select id="filterSelect">
        <option value="daily">Daily</option>
        <option value="monthly" selected>Monthly</option>
        <option value="yearly">Yearly</option>
      </select>
    </div>

    <!-- Charts -->
    <div class="chart-wrapper">
      <div class="chart-box">
        <canvas id="barChart"></canvas>
      </div>
      <div class="chart-box">
        <canvas id="pieChart"></canvas>
      </div>
    </div>
  </main>
</div>

<%- include('../partials/admin/footer') %>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  let barChart, pieChart;

  async function fetchChartData(filter = "monthly") {
    const res = await fetch(`/admin/chart-data?filter=${filter}`);
    const data = await res.json();

    updateBarChart(data.salesLabel, data.salesData);
    updatePieChart(data.statusLabels, data.statusData);
  }

  function updateBarChart(labels, data) {
    const ctx = document.getElementById("barChart").getContext("2d");
    if (barChart) barChart.destroy();
    barChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels,
        datasets: [{
          label: "Sales (â‚¹)",
          data,
          backgroundColor: "rgba(255, 209, 220)",
          borderColor: "#007bff",
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } }
      }
    });
  }

  function updatePieChart(labels, data) {
    const ctx = document.getElementById("pieChart").getContext("2d");
    if (pieChart) pieChart.destroy();
    pieChart = new Chart(ctx, {
      type: "pie",
      data: {
        labels,
        datasets: [{
          data,
          backgroundColor: ["#007bff", "#28a745", "#ffc107", "#dc3545" , "#77DD77"]
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: "bottom" } }
      }
    });
  }

  document.getElementById("filterSelect").addEventListener("change", (e) => {
    fetchChartData(e.target.value);
  });

  // Initial chart load
  fetchChartData("monthly");
</script>

<script>
  document.getElementById("sidebarToggle").addEventListener("click", () => {
    document.getElementById("adminSidebar").classList.toggle("active");
  });
</script>

<style>
  .admin-main {
    padding: 20px;
  }
  .stats {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
  }
  .stat-card {
    background: #f1f1f1;
    padding: 15px 25px;
    border-radius: 10px;
    font-weight: 500;
  }
  .chart-filter {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
  }
  .chart-wrapper {
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
  }
  .chart-box {
    flex: 1;
    min-width: 400px;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  #filterSelect {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
</style>


