<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Orders</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

  <h2 class="mb-4">My Orders</h2>

  <% if (message) { %>
  <div class="alert alert-<%= type || 'info' %>">
    <%= message %>
  </div>
<% } %>

  <% if (orders.length === 0) { %>
    <p>You have no orders yet.</p>
  <% } else { %>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Product</th>
          <th>Qty</th>
          <th>Total</th>
          <th>Order Status</th>
          <th>Payment Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% orders.forEach(order => { %>
          <% order.products.forEach(item => { %>
            <tr>
              <td>
                <img src="/images/<%= item.productId.images?.[0] || 'default-image.jpg' %>" width="60" class="me-2">
                <%= item.productId.name %>
              </td>
              <td><%= item.quantity %></td>
              <td>â‚¹<%= order.finalPrice.toFixed(2) %></td>
              <td><span class="badge bg-info"><%= order.orderStatus %></span></td>
              <td><span class="badge bg-success"><%= order.paymentStatus %></span></td>
              <td>
                <% if (order.orderStatus !== 'Cancelled' && order.orderStatus !== 'Delivered') { %>
                  <form method="POST" action="/myorders/<%= order._id %>/cancel">
                    <button class="btn btn-danger btn-sm">Cancel</button>
                  </form>
                <% } %> <br>
                  <form method="GET" action="/myorders/<%= order._id %>/orderDetails">
        <button class="btn btn-info btn-sm">Order Details</button>
      </form>
              </td>
              
            </tr>
          <% }) %>
        <% }) %>
      </tbody>
    </table>
  <% } %>

</body>
</html>
