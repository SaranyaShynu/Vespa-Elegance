<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order Details - Vespa Elegance</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <style>
    body { background-color: #f8f9fa; font-family: 'Mukta', sans-serif; }
    .badge { font-size: 0.9rem; }
    .table th, .table td { vertical-align: middle; }
    @media (max-width: 576px) {
      .table-responsive-stack tr {
        display: flex;
        flex-direction: column;
        margin-bottom: 1rem;
        border-bottom: 1px solid #dee2e6;
      }
      .table-responsive-stack td {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
      }
      .table-responsive-stack th { display: none; }
    }
  </style>
</head>
<body>

<div class="container my-5">
  <h2 class="mb-4">Order Details</h2>

  <!-- Order Info -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <p><strong>Order ID:</strong> <%= order.orderId %></p>
      <p><strong>Order Status:</strong> 
        <span class="badge <%= order.orderStatus === 'Delivered' ? 'bg-success' : order.orderStatus === 'Cancelled' ? 'bg-danger' : 'bg-warning' %>">
          <%= order.orderStatus %>
        </span>
      </p>
      <p><strong>Payment Status:</strong> 
        <span class="badge <%= order.paymentStatus === 'Paid' ? 'bg-success' : 'bg-danger' %>"><%= order.paymentStatus %></span>
      </p>
    </div>
  </div>

  <!-- Products Table -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body table-responsive">
      <h4 class="mb-3">Products</h4>
      <table class="table table-bordered table-responsive-stack">
        <thead>
          <tr>
            <th>Product</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <% order.products.forEach(item => { %>
            <tr>
              <td><strong><%= item.productId.name %></strong></td>
              <td><%= item.quantity %></td>
              <td>₹<%= item.price %></td>
              <td>₹<%= item.price * item.quantity %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
      <p class="mt-3"><strong>Subtotal:</strong> ₹<%= order.price %></p>
      <p><strong>Discount:</strong> ₹<%= order.discount %></p>
      <p><strong>Total:</strong> ₹<%= order.finalPrice %></p>
    </div>
  </div>

  <!-- Shipping Address -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h4 class="mb-3">Shipping Address</h4>
      <p>
        <strong><%= order.address.name %></strong><br>
        <%= order.address.street %>, <%= order.address.city %>, <%= order.address.state %> - <%= order.address.zip %>
      </p>
    </div>
  </div>

  <!-- Actions -->
  <div class="mb-4">
    <% if (order.orderStatus === 'Delivered') { %>
      <form method="GET" action="/invoice/<%= order._id %>" class="d-inline">
        <button class="btn btn-primary me-2">Download Invoice</button>
      </form>
    <% } else if (order.orderStatus === 'Cancelled' || order.paymentStatus === 'Refunded') { %>
      <span class="text-danger">This order was <%= order.orderStatus %> / <%= order.paymentStatus %></span>
    <% } %>
  </div>

  <a href="/myorders" class="btn btn-outline-secondary">← Back to My Orders</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
